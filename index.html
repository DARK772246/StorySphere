<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>StorySphere</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css"/>
    <style>
        body{background-color:#111827}.swiper-slide{background-size:cover;background-position:center}.swiper-pagination-bullet-active{background-color:#db2777!important}.glassmorphism{background:rgba(255,255,255,0.05);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.1)}.rating-stars span{cursor:pointer;color:#4b5563}.rating-stars span.selected,.rating-stars span:hover,.rating-stars span:hover~span{color:#f59e0b}
    </style>
</head>
<body class="text-white">
    <header class="bg-black bg-opacity-50 p-4 flex justify-between items-center sticky top-0 backdrop-blur-sm z-20">
        <h1 class="text-2xl font-bold text-pink-500">StorySphere</h1>
        <button id="menu-btn" class="md:hidden z-30"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg></button>
        <nav id="mobile-menu" class="hidden md:flex md:items-center space-x-4 absolute md:relative top-0 left-0 w-full h-screen md:h-auto md:w-auto bg-gray-900 md:bg-transparent flex-col md:flex-row justify-center">
            <a href="#browse" class="text-lg my-4 md:my-0">Browse</a><a href="#private-browse" id="private-link" class="text-lg my-4 md:my-0">Private Novels</a><a href="#about" class="text-lg my-4 md:my-0">About</a>
        </nav>
    </header>

    <div id="featured-slider" class="swiper h-80 md:h-96 w-full -mt-16"><div class="swiper-wrapper"></div><div class="swiper-pagination"></div></div>

    <main class="p-4 md:p-8">
        <section id="browse" class="my-12"><h2 class="text-3xl font-bold text-center mb-8">Public Novels</h2><div id="browse-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div></section>
        <section id="private-browse" class="my-12" style="display:none"><h2 class="text-3xl font-bold text-center mb-8">Private Novels (18+)</h2><div id="private-browse-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div></section>
    </main>

    <section id="about" class="my-12 p-4"><div class="max-w-3xl mx-auto glassmorphism p-8 rounded-xl text-center"><h2 class="text-2xl font-bold mb-4">About StorySphere</h2><p class="text-gray-300">...</p><p class="mt-4 text-sm text-gray-500">Developed by Salman Khan Orakzai</p></div></section>

    <div id="age-gate-popup" style="display:none" class="fixed inset-0 bg-black bg-opacity-80 flex justify-center items-center z-50"><div class="glassmorphism p-8 rounded-xl text-center w-11/12 max-w-md"><h2 class="text-2xl font-bold mb-4 text-yellow-400">Content Warning</h2><p class="text-lg mb-6">This section is for users 18 and older. Are you sure you want to proceed?</p><div class="flex justify-center gap-4"><button id="confirmAgeBtn" class="bg-green-600 p-2 rounded">Yes, I am 18+</button><button id="denyAgeBtn" class="bg-red-600 p-2 rounded">No, Go Back</button></div></div></div>
    
    <div id="book-modal" style="display:none" class="fixed inset-0 bg-black bg-opacity-80 flex justify-center items-center z-40 p-4" onclick="this.style.display='none'">
        <div class="glassmorphism rounded-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
            <div class="flex flex-col md:flex-row">
                <img id="book-image" class="w-full md:w-1/3 object-cover rounded-t-xl md:rounded-l-xl md:rounded-t-none">
                <div class="p-6 flex-1 flex flex-col">
                    <h2 id="book-title" class="text-3xl font-bold"></h2>
                    <p id="book-author" class="text-lg text-gray-300"></p>
                    <p id="book-series" class="text-sm text-pink-400 mb-4"></p>
                    <p id="book-genre"></p>
                    <p id="book-pages"></p>
                    <p id="book-description" class="my-4 flex-grow"></p>
                    <div id="series-info" class="mb-4"></div>
                    <div class="flex flex-wrap gap-2 mb-4">
                        <a id="read-btn" href="#" class="bg-pink-600 p-2 rounded">Read Now</a>
                        <a id="download-btn" href="#" download class="bg-yellow-500 text-black p-2 rounded">Download</a>
                        <button id="share-btn" class="bg-blue-500 p-2 rounded">Share</button>
                    </div>
                    <hr class="border-gray-700 my-4">
                    <h3 class="text-xl font-semibold">Leave a Review</h3>
                    <form id="rating-form" class="space-y-2 mt-2">
                        <div class="rating-stars" data-rating="0">
                            <span data-value="1">★</span><span data-value="2">★</span><span data-value="3">★</span><span data-value="4">★</span><span data-value="5">★</span>
                        </div>
                        <input id="reviewer-name" placeholder="Your Name" class="w-full p-2 rounded text-black" required>
                        <textarea id="review-text" placeholder="Your review..." class="w-full p-2 rounded text-black" rows="2" required></textarea>
                        <button type="submit" class="bg-green-500 p-2 rounded w-full">Submit</button>
                    </form>
                    <h3 class="text-xl font-semibold mt-4">Reviews</h3>
                    <div id="reviews-list" class="space-y-2 max-h-40 overflow-y-auto"></div>
                </div>
            </div>
        </div>
    </div>

    <footer class="text-center p-6 text-gray-500"><div class="flex justify-center space-x-6 mb-4"><a href="..."><i class="fab fa-tiktok"></i></a><a href="..."><i class="fab fa-instagram"></i></a><a href="..."><i class="fab fa-whatsapp"></i></a></div><p>&copy; 2024 StorySphere. All rights reserved.</p></footer>

    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://zovzpiolbqezdjghhrgt.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpvdnpwaW9sYnFlemRqZ2hocmd0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Nzc0NzMsImV4cCI6MjA3MTA1MzQ3M30.t_dvIsnbwUFsgB1Bs1gcyo_Mic-z3i0g6pqMeQIoiXI';
        const { createClient } = window.supabase;
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        let books=[],series=[],selectedBookId=null;
        const menuBtn=document.getElementById("menu-btn"),mobileMenu=document.getElementById("mobile-menu"),ageGatePopup=document.getElementById("age-gate-popup"),privateBrowseSection=document.getElementById("private-browse"),bookModal=document.getElementById("book-modal");
        menuBtn.addEventListener("click",()=>{mobileMenu.classList.toggle("hidden")});
        document.querySelectorAll("#mobile-menu a").forEach(e=>{e.addEventListener("click",()=>mobileMenu.classList.add("hidden"))});
        document.getElementById("private-link").addEventListener("click",e=>{e.preventDefault(),"true"===localStorage.getItem("ageConfirmed")?(privateBrowseSection.style.display="block",window.location.hash="#private-browse"):ageGatePopup.style.display="flex"});
        document.getElementById("confirmAgeBtn").addEventListener("click",()=>{localStorage.setItem("ageConfirmed","true"),ageGatePopup.style.display="none",privateBrowseSection.style.display="block",window.location.hash="#private-browse"});
        document.getElementById("denyAgeBtn").addEventListener("click",()=>{ageGatePopup.style.display="none"});
        
        async function getData(){let{data:e}=await supabase.from("books").select("*").order("created_at",{ascending:!1});let{data:t}=await supabase.from("series").select("*");books=e||[],series=t||[],renderBookCards(),setupSlider()}
        function setupSlider(){const e=document.querySelector("#featured-slider .swiper-wrapper");e.innerHTML="",books.filter(e=>!e.is_private).slice(0,5).forEach(t=>{const s=document.createElement("div");s.className="swiper-slide",s.style.backgroundImage=`url(${t.image})`,s.innerHTML=`<div class="absolute inset-0 bg-black bg-opacity-60 flex flex-col justify-end items-start text-left p-8"><h2 class="text-3xl font-bold">${t.title}</h2><p class="text-lg my-1">${t.author}</p><button class="mt-2 bg-pink-600 text-white px-4 py-2 rounded-lg" onclick="showBookDetails(${t.id})">View Details</button></div>`,e.appendChild(s)}),new Swiper("#featured-slider",{loop:!0,autoplay:{delay:4e3},pagination:{el:".swiper-pagination",clickable:!0}})}
        function renderBookCards(){const e=document.getElementById("browse-grid"),t=document.getElementById("private-browse-grid");e.innerHTML="",t.innerHTML="",books.forEach(s=>{const a=s.is_private?t:e;createCard(s,a)})}
        function createCard(e,t){const s=document.createElement("div");s.className="glassmorphism rounded-xl overflow-hidden transition-transform hover:scale-105",s.setAttribute("data-book-id",e.id);const a=e.series_id?series.find(t=>t.id===e.series_id):null,i=a?`<p class="text-xs text-pink-400">${a.title}</p>`:"";s.innerHTML=`<img src="${e.image}" class="w-full h-64 object-cover"><div class="p-4"><h3 class="font-bold text-lg truncate">${e.title}</h3>${i}<p class="text-sm text-gray-300">${e.author||""}</p><button class="mt-2 bg-pink-600 w-full p-2 rounded-lg font-bold">View Details</button></div>`,t.appendChild(s),s.querySelector("button").addEventListener("click",()=>showBookDetails(e.id))}
        function showBookDetails(e){selectedBookId=e;const t=books.find(t=>t.id===e);if(!t)return;document.getElementById("book-image").src=t.image,document.getElementById("book-title").textContent=t.title,document.getElementById("book-author").textContent=`By ${t.author||"N/A"}`,document.getElementById("book-series").textContent=t.series_id?series.find(e=>e.id===t.series_id)?.title||"":"";document.getElementById("book-genre").textContent=`Genre: ${t.genre}`,document.getElementById("book-pages").textContent=`Pages: ${t.pages}`,document.getElementById("book-description").textContent=t.description;const s=document.getElementById("read-btn"),a=document.getElementById("download-btn"),i=document.getElementById("share-btn"),l=document.getElementById("series-info");l.innerHTML="",t.series_id&&(()=>{const e=series.find(e=>e.id===t.series_id),s=books.filter(e=>e.series_id===t.series_id);let a=`<h4 class="text-lg font-semibold text-pink-400 mb-2">Parts of "${e.title}"</h4><ul class="list-disc list-inside">`;s.forEach(e=>{a+=`<li>${e.title} ${e.id===t.id?"(Current)":""}</li>`}),a+="</ul>",l.innerHTML=a})(),t.story_text?(s.style.display="inline-block",s.href=`reader.html?id=${t.id}`):s.style.display="none",t.pdf?(a.style.display="inline-block",a.href=t.pdf):a.style.display="none",i.onclick=async()=>{try{await navigator.share({title:t.title,url:window.location.href})}catch(e){alert("Share failed")}},loadReviews(e),bookModal.style.display="flex"}
        const ratingForm=document.getElementById("rating-form"),ratingStars=document.querySelector(".rating-stars");let currentRating=0;ratingStars.addEventListener("click",e=>{"SPAN"===e.target.tagName&&(currentRating=e.target.dataset.value,Array.from(ratingStars.children).forEach(e=>e.classList.toggle("selected",e.dataset.value<=currentRating)))}),ratingForm.addEventListener("submit",async e=>{e.preventDefault();if(0===currentRating)return alert("Please select a rating.");const t={book_id:selectedBookId,rating:currentRating,reviewer_name:document.getElementById("reviewer-name").value,review_text:document.getElementById("review-text").value};const{error}=await supabase.from("ratings").insert([t]);error?alert(error.message):(alert("Review submitted!"),ratingForm.reset(),currentRating=0,Array.from(ratingStars.children).forEach(e=>e.classList.remove("selected")),loadReviews(selectedBookId))});
        async function loadReviews(e){const t=document.getElementById("reviews-list");t.innerHTML="Loading...";const{data,error}=await supabase.from("ratings").select("*").eq("book_id",e);if(error)t.innerHTML="Could not load reviews.";else if(t.innerHTML="",0===data.length)t.innerHTML="<p>No reviews yet.</p>";else for(const e of data){const s=document.createElement("div");s.className="bg-gray-800 p-2 rounded",s.innerHTML=`<p class="font-bold">${e.reviewer_name} - ${"★".repeat(e.rating)}${"☆".repeat(5-e.rating)}</p><p class="text-sm">${e.review_text}</p>`,t.appendChild(s)}}
        getData();
    </script>
</body>
</html>