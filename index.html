<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StorySphere - 3D Novel Reader</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .pen { width: 12px; height: 50px; background: #FFD700; position: absolute; transform-origin: bottom; animation: write 3s ease-out forwards; margin-top: -50px; margin-left: -80px; }
        .text-reveal { opacity: 0; animation: fade 3s ease-out forwards; }
        @keyframes write { 0% { transform: translateX(-80px) rotate(30deg); } 100% { transform: translateX(80px) rotate(30deg); } }
        @keyframes fade { 0% { opacity: 0; } 50% { opacity: 0; } 100% { opacity: 1; } }
        #enter-btn { transition: all 0.3s; }
        #enter-btn:hover { background-color: #92400e; }
        html { scroll-behavior: smooth; }
        body { overflow-x: hidden; }
        #canvas-container { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 0; }
        #splash-screen { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: #1f2937; display: flex; justify-content: center; align-items: center; z-index: 100; color: #fff; flex-direction: column; opacity: 1; transition: opacity 1s ease-out; }
        #splash-screen.hidden { opacity: 0; pointer-events: none; }
        .glassmorphism { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1); }
        .hover-scale { transition: transform 0.3s ease; }
        .hover-scale:hover { transform: scale(1.05); }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 20; overflow-y: auto; }
        .modal-content { max-width: 800px; margin: 2rem auto; }
        .social-icon { transition: transform 0.3s ease; }
        .social-icon:hover { transform: scale(1.2); }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 text-white">
    <div id="splash-screen"><div class="text-center"><h1 class="text-4xl font-serif text-reveal">Storysphere</h1><div class="pen"></div><button id="enter-btn" class="mt-8 px-4 py-2 bg-amber-700 rounded text-lg font-semibold">Explore Stories</button><p class="mt-4 text-sm opacity-70">By Salman Khan Orakzai</p></div></div>

    <div id="canvas-container"></div>
    <div class="relative z-10 min-h-screen flex flex-col">
        <header class="glassmorphism p-4 flex justify-between items-center"><h1 class="text-3xl font-bold tracking-tight">StorySphere</h1><nav class="space-x-6"><a href="#" class="text-lg hover:text-pink-300 transition-colors">Home</a><a href="#browse" class="text-lg hover:text-pink-300 transition-colors">Browse</a><a href="#about" class="text-lg hover:text-pink-300 transition-colors">About</a></nav></header>

        <main class="flex-grow flex flex-col items-center justify-center py-12 px-4"><div class="text-center max-w-2xl"><h2 class="text-4xl md:text-5xl font-extrabold mb-6 bg-clip-text text-transparent bg-gradient-to-r from-pink-500 to-yellow-500">Dive into Stories with 3D Magic</h2><p class="text-lg md:text-xl text-gray-200 mb-8">Experience novels and stories like never before with our immersive 3D interface.</p></div><div id="browse" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl w-full"></div></main>

        <section id="about" class="py-12 px-4"><div class="max-w-4xl mx-auto glassmorphism p-8 rounded-xl"><h2 class="text-3xl font-bold text-center mb-4">About StorySphere</h2><p class="text-center text-gray-200 mb-4">StorySphere is a magical place where stories come to life. We believe in the power of imagination and offer an immersive reading experience that blends technology with the timeless art of storytelling. Dive in and explore new worlds!</p><p class="text-center text-gray-400 text-sm">This website is developed by Salman Khan Orakzai.</p></div></section>

        <div id="offer-popup" class="modal"><div class="modal-content glassmorphism p-8 rounded-xl text-center"><h3 class="text-2xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-pink-500 to-yellow-500">âœ¨ Exclusive Offer! âœ¨</h3><p class="text-lg text-gray-200 mb-6">Visit our website now to explore the best sales and amazing discounts available for a limited time. Donâ€™t miss outâ€”shop today and save big!</p><div class="flex justify-center gap-4"><a href="https://noore-elegance-store.vercel.app/" target="_blank" class="bg-pink-500 text-white px-6 py-3 rounded-lg hover:bg-pink-600 transition-colors inline-block">ðŸ›’ Shop Now</a><button id="continue-btn" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors">Continue to Story</button></div></div></div>
        
        <div id="book-modal" class="modal"><div class="modal-content p-6 rounded-xl glassmorphism"><div class="flex flex-col md:flex-row gap-6"><img id="book-image" class="w-full md:w-1/3 rounded-lg" src="" alt="Book Cover"><div class="flex-1"><h2 id="book-title" class="text-3xl font-bold mb-4"></h2><p id="book-genre" class="text-gray-300 mb-2"></p><p id="book-pages" class="text-gray-300 mb-4"></p><p id="book-description" class="text-gray-200 mb-6"></p>
        
        <!-- *** BUTTONS SECTION MODIFIED *** -->
        <div class="flex gap-4 mb-6">
            <!-- "Read Now" button is removed -->
            <a id="download-btn" href="#" download class="bg-yellow-500 text-black px-4 py-2 rounded-lg hover:bg-yellow-600">Download</a>
            <button id="share-btn" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">Share</button>
            <button id="close-modal" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600">Close</button>
        </div>
        
        <div class="flex justify-center space-x-6 mt-4"><a href="https://www.tiktok.com/@hba013?_t=ZS-8yy2XEeMu7l&_r=1" target="_blank" class="social-icon text-2xl hover:text-pink-300"><i class="fab fa-tiktok"></i></a><a href="https://www.instagram.com/salman_orakxi?igsh=dWlxc2oxZnlyd3Bo" target="_blank" class="social-icon text-2xl hover:text-pink-300"><i class="fab fa-instagram"></i></a><a href="https://wa.me/03275176283" target="_blank" class="social-icon text-2xl hover:text-pink-300"><i class="fab fa-whatsapp"></i></a></div></div></div></div></div>

        <footer class="glassmorphism p-6 text-center text-gray-300"><div class="flex justify-center space-x-6 mb-4"><a href="https://www.tiktok.com/@hba013?_t=ZS-8yy2XEeMu7l&_r=1" target="_blank" class="social-icon text-2xl hover:text-pink-300"><i class="fab fa-tiktok"></i></a><a href="https://www.instagram.com/salman_orakxi?igsh=dWlxc2oxZnlyd3Bo" target="_blank" class="social-icon text-2xl hover:text-pink-300"><i class="fab fa-instagram"></i></a><a href="https://wa.me/03275176283" target="_blank" class="social-icon text-2xl hover:text-pink-300"><i class="fab fa-whatsapp"></i></a></div><p>&copy; 2025 StorySphere. All rights reserved.</p></footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script>
        const SUPABASE_URL = 'https://zovzpiolbqezdjghhrgt.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpvdnpwaW9sYnFlemRqZ2hocmd0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0Nzc0NzMsImV4cCI6MjA3MTA1MzQ3M30.t_dvIsnbwUFsgB1Bs1gcyo_Mic-z3i0g6pqMeQIoiXI';
        const { createClient } = window.supabase;
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const splashScreen = document.getElementById('splash-screen');
        const bookListContainer = document.getElementById('browse');
        const bookModal = document.getElementById('book-modal');
        const offerPopup = document.getElementById('offer-popup');
        let books = [];
        let selectedBookId = null;

        document.getElementById('enter-btn').addEventListener('click', () => { splashScreen.classList.add('hidden'); });
        document.getElementById('continue-btn').addEventListener('click', () => { offerPopup.style.display = 'none'; showBookDetails(selectedBookId); });
        document.getElementById('close-modal').addEventListener('click', () => { bookModal.style.display = 'none'; });

        async function getBooks() { /* ... unchanged ... */ }
        function renderBookCards() { /* ... unchanged ... */ }
        function addCardEventListeners() { /* ... unchanged ... */ }

        function showBookDetails(bookId) {
            const bookData = books.find(b => b.id === bookId);
            if (!bookData) return;

            document.getElementById('book-title').textContent = bookData.title;
            document.getElementById('book-genre').textContent = `Genre: ${bookData.genre}`;
            document.getElementById('book-pages').textContent = `Length: ${bookData.pages}`;
            document.getElementById('book-description').textContent = bookData.description;
            document.getElementById('book-image').src = bookData.image;

            const downloadBtn = document.getElementById('download-btn');
            const shareBtn = document.getElementById('share-btn');
            
            // Show/hide download button based on PDF availability
            if (bookData.pdf) {
                downloadBtn.href = bookData.pdf;
                downloadBtn.style.display = 'inline-block';
            } else {
                downloadBtn.style.display = 'none';
            }

            // *** NEW SHARE BUTTON LOGIC ***
            shareBtn.onclick = async () => {
                const shareData = {
                    title: bookData.title,
                    text: `Check out this story on StorySphere: "${bookData.title}" by Salman Khan Orakzai`,
                    url: window.location.href
                };
                try {
                    // Use the native Web Share API
                    await navigator.share(shareData);
                    console.log('Story shared successfully');
                } catch (err) {
                    console.error('Error sharing story:', err);
                    // Fallback for browsers that don't support it
                    alert('Sharing failed. You can copy the link from the address bar.');
                }
            };
            
            bookModal.style.display = 'block';
        }

        // --- Unchanged Helper and Initialization Functions ---
        async function getBooks() {
            const { data, error } = await supabase.from('books').select('*');
            if (error) { console.error('Error fetching books:', error); bookListContainer.innerHTML = `<p class="text-red-400 text-center col-span-full">Error loading stories. Please check Supabase connection.</p>`; } else { books = data; renderBookCards(); }
        }
        function renderBookCards() {
            bookListContainer.innerHTML = '';
            if (books.length === 0) { bookListContainer.innerHTML = `<p class="text-gray-300 text-center col-span-full">No stories found. Add some from the admin panel!</p>`; return; }
            books.forEach(bookData => {
                const card = document.createElement('div');
                card.className = 'glassmorphism p-6 rounded-xl hover-scale book-card';
                card.setAttribute('data-book-id', bookData.id);
                card.innerHTML = `<h3 class="text-xl font-semibold mb-2">${bookData.title}</h3><p class="text-gray-300 mb-4">${bookData.genre} | ${bookData.pages}</p><button class="bg-pink-500 text-white px-4 py-2 rounded-lg hover:bg-pink-600 transition-colors w-full">View Details</button>`;
                bookListContainer.appendChild(card);
            });
            addCardEventListeners();
        }
        function addCardEventListeners() {
            document.querySelectorAll('.book-card').forEach(card => {
                card.querySelector('button').addEventListener('click', () => {
                    selectedBookId = parseInt(card.getAttribute('data-book-id'));
                    offerPopup.style.display = 'block';
                });
            });
        }
        getBooks();

        // --- Unchanged 3D Scene ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);
        const bookGeometry = new THREE.BoxGeometry(2, 3, 0.3);
        const bookTexture = new THREE.TextureLoader().load('https://images.unsplash.com/photo-1544716278-ca5e3f4ebf0c?auto=format&fit=crop&w=200');
        const bookMaterial = new THREE.MeshStandardMaterial({ map: bookTexture, roughness: 0.4, metalness: 0.2 });
        const book = new THREE.Mesh(bookGeometry, bookMaterial);
        scene.add(book);
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(5, 5, 5);
        scene.add(directionalLight);
        camera.position.z = 5;
        function animate() { requestAnimationFrame(animate); book.rotation.y += 0.005; book.position.y = Math.sin(Date.now() * 0.001) * 0.2; renderer.render(scene, camera); }
        animate();
        window.addEventListener('resize', () => { camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });
    </script>
</body>
</html>