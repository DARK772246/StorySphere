<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StorySphere</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6036065566084740" crossorigin="anonymous"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .pen{width:12px;height:50px;background:#FFD700;position:absolute;transform-origin:bottom;animation:write 3s ease-out forwards;margin-top:-50px;margin-left:-80px}.text-reveal{opacity:0;animation:fade 3s ease-out forwards}@keyframes write{0%{transform:translateX(-80px) rotate(30deg)}100%{transform:translateX(80px) rotate(30deg)}}@keyframes fade{0%{opacity:0}50%{opacity:0}100%{opacity:1}}#enter-btn{transition:all .3s}#enter-btn:hover{background-color:#92400e}html{scroll-behavior:smooth}body{overflow-x:hidden}#canvas-container{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:0}#splash-screen{position:fixed;top:0;left:0;width:100vw;height:100vh;background:#1f2937;display:flex;justify-content:center;align-items:center;z-index:100;color:#fff;flex-direction:column;opacity:1;transition:opacity 1s ease-out}#splash-screen.hidden{opacity:0;pointer-events:none}.glassmorphism{background:rgba(255,255,255,.1);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2);box-shadow:0 4px 30px rgba(0,0,0,.1)}.hover-scale{transition:transform .3s ease}.hover-scale:hover{transform:scale(1.05)}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;z-index:20;overflow-y:auto}.modal-content{max-width:800px;margin:2rem auto}.social-icon{transition:transform .3s ease}.social-icon:hover{transform:scale(1.2)}
        /* *** AGE GATE POPUP KE LIYE NAYA STYLE *** */
        #age-gate-popup { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 99; justify-content: center; align-items: center; }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 text-white">
    <div id="splash-screen"><div class="text-center"><h1 class="text-4xl font-serif text-reveal">Storysphere</h1><div class="pen"></div><button id="enter-btn" class="mt-8 px-4 py-2 bg-amber-700 rounded text-lg font-semibold">Explore Stories</button><p class="mt-4 text-sm opacity-70">By Salman Khan Orakzai</p></div></div>
    <div id="canvas-container"></div>
    <div class="relative z-10 min-h-screen flex flex-col">
        <header class="glassmorphism p-4 flex justify-between items-center"><h1 class="text-3xl font-bold tracking-tight">StorySphere</h1><nav class="space-x-6"><a href="#browse" class="text-lg hover:text-pink-300">Browse</a>
        <!-- *** NAYA PRIVATE TAB *** -->
        <a href="#private-browse" id="private-link" class="text-lg hover:text-pink-300">Private Novels</a>
        <a href="#about" class="text-lg hover:text-pink-300">About</a></nav></header>
        
        <main class="flex-grow flex flex-col items-center justify-center py-12 px-4">
            <div class="text-center max-w-2xl"><h2 class="text-4xl md:text-5xl font-extrabold mb-6 bg-clip-text text-transparent bg-gradient-to-r from-pink-500 to-yellow-500">Dive into Stories with 3D Magic</h2><p class="text-lg md:text-xl text-gray-200 mb-8">Experience novels and stories like never before.</p></div>
            <!-- Public Novels Section -->
            <section id="browse" class="w-full max-w-6xl mb-12"><h2 class="text-3xl font-bold text-center mb-6">Public Novels</h2><div id="browse-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div></section>
            <!-- *** NAYA PRIVATE NOVELS SECTION *** -->
            <section id="private-browse" class="w-full max-w-6xl" style="display: none;"><h2 class="text-3xl font-bold text-center mb-6">Private Novels (18+)</h2><div id="private-browse-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div></section>
        </main>

        <section id="about" class="py-12 px-4"><div class="max-w-4xl mx-auto glassmorphism p-8 rounded-xl"><h2 class="text-3xl font-bold text-center mb-4">About StorySphere</h2><p class="text-center text-gray-200 mb-4">...</p><p class="text-center text-gray-400 text-sm">This website is developed by Salman Khan Orakzai.</p></div></section>
        
        <!-- *** NAYA AGE GATE POPUP *** -->
        <div id="age-gate-popup" class="flex"><div class="glassmorphism p-8 rounded-xl text-center w-11/12 max-w-md"><h2 class="text-2xl font-bold mb-4 text-yellow-300">Content Warning</h2><p class="text-lg mb-6">This section contains mature content. Are you 18 or older and wish to proceed?</p><div class="flex justify-center gap-4"><button id="confirmAgeBtn" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded">Yes, I am 18+</button><button id="denyAgeBtn" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded">No, Go Back</button></div></div></div>

        <!-- ... baaki ka code pehle jaisa ... -->
        <div id="offer-popup" class="modal">...</div>
        <div id="book-modal" class="modal">...</div>
        <footer class="glassmorphism p-6 text-center text-gray-300">...</footer>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script>
        const SUPABASE_URL = 'https://zovzpiolbqezdjghhrgt.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpvdnpwaW9sYnFlemRqZ2hocmd0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0Nzc0NzMsImV4cCI6MjA3MTA1MzQ3M30.t_dvIsnbwUFsgB1Bs1gcyo_Mic-z3i0g6pqMeQIoiXI';
        const { createClient } = window.supabase;
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const splashScreen = document.getElementById('splash-screen');
        const bookModal = document.getElementById('book-modal');
        const offerPopup = document.getElementById('offer-popup');
        const ageGatePopup = document.getElementById('age-gate-popup');
        const privateBrowseSection = document.getElementById('private-browse');
        let books = []; let selectedBookId = null;

        document.getElementById('enter-btn').addEventListener('click', () => { splashScreen.classList.add('hidden'); });
        document.getElementById('private-link').addEventListener('click', (e) => {
            e.preventDefault();
            if (localStorage.getItem('ageConfirmed') === 'true') {
                privateBrowseSection.style.display = 'block';
                window.location.hash = '#private-browse';
            } else {
                ageGatePopup.style.display = 'flex';
            }
        });
        document.getElementById('confirmAgeBtn').addEventListener('click', () => {
            localStorage.setItem('ageConfirmed', 'true');
            ageGatePopup.style.display = 'none';
            privateBrowseSection.style.display = 'block';
            window.location.hash = '#private-browse';
        });
        document.getElementById('denyAgeBtn').addEventListener('click', () => {
            ageGatePopup.style.display = 'none';
        });

        async function getBooks() {
            const { data, error } = await supabase.from('books').select('*');
            if (error) { console.error(error); } else { books = data; renderBookCards(); }
        }
        function renderBookCards() {
            const publicGrid = document.getElementById('browse-grid');
            const privateGrid = document.getElementById('private-browse-grid');
            publicGrid.innerHTML = ''; privateGrid.innerHTML = '';
            
            const publicBooks = books.filter(b => !b.is_private);
            const privateBooks = books.filter(b => b.is_private);

            publicBooks.forEach(book => createCard(book, publicGrid));
            privateBooks.forEach(book => createCard(book, privateGrid));
            
            addCardEventListeners();
        }
        function createCard(bookData, container) {
            const card = document.createElement('div');
            card.className = 'glassmorphism p-6 rounded-xl hover-scale book-card';
            card.setAttribute('data-book-id', bookData.id);
            card.innerHTML = `<h3 class="text-xl font-semibold mb-2">${bookData.title}</h3><p class="text-gray-300 mb-4">${bookData.author}</p><button class="bg-pink-500 text-white px-4 py-2 rounded-lg w-full">View Details</button>`;
            container.appendChild(card);
        }
        function showBookDetails(bookId) {
            const bookData = books.find(b => b.id === bookId);
            // ... baaki showBookDetails ka function pehle jaisa ...
        }
        // ... baaki sab functions pehle jaisey ...
    </script>
</body>
</html>